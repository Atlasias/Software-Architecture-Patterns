## 제 2 장
# 이벤트 중심 아키텍처
이벤트 중심 아키텍처 패턴은 확장 성이 뛰어난 애플리케이션을 생성하는 데 사용되는 널리 사용되는 분산 비동기 아키텍처 패턴입니다. 또한 적응력이 뛰어나고 작은 응용 프로그램뿐만 아니라 크고 복잡한 응용 프로그램에도 사용할 수 있습니다. 이벤트 중심 아키텍처는 이벤트를 비동기 적으로 수신하고 처리하는 고도로 분리 된 단일 목적 이벤트 처리 구성 요소로 구성됩니다.
이벤트 중심 아키텍처 패턴은 중재자와 브로커의 두 가지 주요 토폴로지로 구성됩니다. 중개자 토폴로지는 일반적으로 중앙 중개자를 통해 이벤트 내에서 여러 단계를 조정해야하는 경우에 사용되는 반면, 중개자 토폴로지는 중앙 중개자를 사용하지 않고 이벤트를 함께 연결하려는 경우에 사용됩니다. 아키텍처 특성과 구현 전략은이 두 토폴로지간에 서로 다르므로 각 상황을 이해하여 특정 상황에 가장 적합한 것을 알아야합니다.

## 중재자 토폴로지
중개자 토폴로지는 여러 단계가 있고 이벤트를 처리하기 위해 일정 레벨의 오케스트레이션이 필요한 이벤트에 유용합니다. 예를 들어, 주식 거래를하는 단일 이벤트의 경우 먼저 거래를 확인한 다음 다양한 준수 규칙에 따라 해당 주식 거래의 준수 여부를 확인하고, 브로커에게 거래를 할당하고, 수수료를 계산하고, 마지막으로 그 브로커. 이러한 모든 단계는 단계의 순서와 연속 및 병렬로 수행 할 수있는 단계를 결정하기 위해 일정 수준의 오케스트레이션이 필요합니다.
중개자 토폴로지 내에는 이벤트 큐, 이벤트 중개자, 이벤트 채널 및 이벤트 프로세서의 네 가지 주요 유형의 아키텍처 구성 요소가 있습니다. 이벤트 플로우는 클라이언트가 이벤트를 이벤트 큐로 전송하여 이벤트를 이벤트 중개자로 전송하는 데 사용됩니다. 이벤트 중개자는 초기 이벤트를 수신하고 추가 비동기 이벤트를 이벤트 채널로 보내 프로세스의 각 단계를 실행하여 해당 이벤트를 오케스트레이션합니다. 이벤트 채널에서 청취하는 이벤트 프로세서는 이벤트 중개자로부터 이벤트를 수신하고 특정 비즈니스 로직을 실행하여 이벤트를 처리합니다. 그림 2-1은 이벤트 중심 아키텍처 패턴의 일반적인 중개자 토폴로지를 보여줍니다.

## 그림 2-1. 이벤트 중심 아키텍처 중재자 토폴로지
이벤트 중심 아키텍처에는 12 개에서 수백 개의 이벤트 큐가있는 것이 일반적입니다. 패턴은 이벤트 큐 구성 요소의 구현을 지정하지 않습니다. 메시지 큐, 웹 서비스 엔드 포인트 또는 이들의 조합 일 수 있습니다.
이 패턴에는 두 가지 유형의 이벤트 (초기 이벤트 및 처리 이벤트)가 있습니다. 초기 이벤트는 중개자가 수신 한 원래 이벤트 인 반면, 처리 이벤트는 중개자가 생성하고 이벤트 처리 구성 요소에 의해 수신 된 이벤트입니다.
이벤트 중개자 구성 요소는 초기 이벤트에 포함 된 단계를 조정합니다. 초기 이벤트의 각 단계마다 이벤트 중개자가 특정 처리 이벤트를 이벤트 채널로 전송 한 후 이벤트 프로세서가이를 수신하여 처리합니다. 이벤트 중개자는 실제로 초기 이벤트를 처리하는 데 필요한 비즈니스 로직을 수행하지는 않습니다. 오히려 초기 이벤트를 처리하는 데 필요한 단계를 알고 있습니다.
이벤트 중개자는 이벤트 채널을 사용하여 초기 이벤트의 각 단계와 관련된 특정 처리 이벤트를 이벤트 프로세서에 비동기 적으로 전달합니다. 이벤트 토픽은 메시지 큐 또는 메시지 토픽이 될 수 있지만, 메시지 토픽은 중개자 토폴로지에서 가장 널리 사용되므로 처리 이벤트가 여러 이벤트 프로세서 (각각 수신 된 처리 이벤트에 따라 다른 태스크를 수행함)에 의해 처리 될 수 있습니다.
이벤트 프로세서 구성 요소에는 처리 이벤트를 처리하는 데 필요한 응용 프로그램 비즈니스 로직이 있습니다. 이벤트 프로세서는 응용 프로그램이나 시스템에서 특정 작업을 수행하는 독립적이고 독립적 인 분리 된 아키텍처 구성 요소입니다.

이벤트 프로세서 구성 요소의 세분성은 세분화 (예 : 주문에 대한 판매 세 계산)에서 세분화 (예 : 보험 청구 처리)에 이르기까지 다양 할 수 있지만 일반적으로 각 구성 요소는 이벤트 프로세서 구성 요소는 단일 비즈니스 타스크를 수행해야하며 특정 이벤트를 완료하기 위해 다른 이벤트 프로세서에 의존하지 않아야합니다.
이벤트 중개자는 다양한 방법으로 구현 될 수 있습니다. 아키텍트는 이벤트 중개자에 대해 선택한 솔루션이 요구 사항 및 요구 사항과 일치하도록 이러한 각 구현 옵션을 이해해야합니다.
이벤트 중개자의 가장 단순하고 가장 일반적인 구현은 Spring Integration, Apache Camel 또는 Mule ESB와 같은 오픈 소스 통합 허브를 통하는 것입니다. 이러한 오픈 소스 통합 허브의 이벤트 흐름은 일반적으로 Java 코드 또는 DSL (도메인 별 언어)을 통해 구현됩니다. 보다 정교한 중개 및 오케스트레이션을 위해 공개 소스 Apache ODE와 같은 BPEL 엔진과 결합 된 BPEL (비즈니스 프로세스 실행 언어)을 사용할 수 있습니다. BPEL은 초기 이벤트 처리에 필요한 데이터 및 단계를 설명하는 표준 XML 유사 언어입니다. 보다 복잡한 오케스트레이션 (인간 상호 작용이 포함 된 단계 포함)이 필요한 대규모 응용 프로그램의 경우 jBPM과 같은 BPM (Business Process Manager)을 사용하여 이벤트 중개자를 구현할 수 있습니다.
이 토폴로지를 사용하여 이벤트 중심 아키텍처의 성공을 위해서는 사용자의 요구를 이해하고 올바른 이벤트 중개자 구현과 일치시키는 것이 중요합니다. 간단한 라우팅 로직을 수행하기 위해 BPM 솔루션을 구현하는 것과 마찬가지로 오픈 소스 통합 허브를 사용하여 매우 복잡한 비즈니스 프로세스 관리 오케스트레이션을 수행하는 것은 실패의 레시피입니다.
중개자 토폴로지의 작동 방식을 설명하기 위해 보험 회사를 통해 보험에 가입하고 이사하기로 결정했다고 가정하십시오. 이 경우 초기 이벤트는 재배치 이벤트와 같은 것으로 불릴 수 있습니다. 재배치 이벤트 처리와 관련된 단계는 그림 2-2에 표시된대로 이벤트 중개자 내에 포함됩니다. 각각의 초기 이벤트 단계에 대해, 이벤트 중재자는 처리 이벤트 (예를 들어, 주소 변경, 재 계산 따옴표 등)를 생성하고, 그 처리 이벤트를 이벤트 채널로 전송하고 처리 이벤트가 대응하는 이벤트 프로세서에 의해 처리 될 때까지 기다린다 (예를 들어, , 고객 프로세스, 견적 프로세스 등). 이 프로세스는 초기 이벤트의 모든 단계가 처리 될 때까지 계속됩니다. 이벤트 조정자의 재 계산 견적 및 업데이트 클레임 단계에 대한 단일 막대는 이러한 단계를 동시에 실행할 수 있음을 나타냅니다.

## 브로커 토폴로지
브로커 토폴로지는 중앙 이벤트 중개자가 없다는 점에서 중개자 토폴로지와 다릅니다. 오히려 메시지 흐름은 경량 메시지 브로커 (예 : ActiveMQ, HornetQ 등)를 통해 체인과 같은 방식으로 이벤트 프로세서 구성 요소에 분산됩니다. 이 토폴로지는 비교적 간단한 이벤트 처리 플로우가 있고 중앙 이벤트 오케스트레이션이 필요하지 않은 경우에 유용합니다. 브로커 토폴로지 내에는 두 가지 주요 유형의 아키텍처 구성 요소 인 브로커 구성 요소와 이벤트 프로세서 구성 요소가 있습니다. 브로커 구성 요소는 중앙 집중식 또는 연합 될 수 있으며 이벤트 플로우에서 사용되는 모든 이벤트 채널을 포함합니다.
브로커 구성 요소에 포함 된 이벤트 채널은 메시지 큐, 메시지 토픽 또는 둘의 조합 일 수 있습니다.

### 그림 2-2. 중개자 토폴로지 예
이 토폴로지는 그림 2-3에 설명되어 있습니다. 다이어그램에서 볼 수 있듯이 초기 이벤트를 제어하고 조정하는 중앙 이벤트 중개자 구성 요소가 없습니다. 각 이벤트 프로세서 구성 요소는 이벤트를 처리하고 방금 수행 한 작업을 나타내는 새 이벤트를 게시합니다. 예를 들어, 주식 포트폴리오의 균형을 유지하는 이벤트 프로세서는 주식 분할이라는 초기 이벤트를 수신 할 수 있습니다. 초기 이벤트를 기반으로 이벤트 프로세서는 일부 포트폴리오 리 밸런싱을 수행 한 다음 리 밸런스 포트폴리오라는 새 이벤트를 브로커에 공개 한 다음 다른 이벤트 프로세서가이를 가져올 수 있습니다. 이벤트가 이벤트 프로세서에 의해 공개되었지만 다른 이벤트 프로세서에 의해 선택되지 않은 경우가있을 수 있습니다. 이것은 응용 프로그램을 발전 시키거나 향후 기능 및 확장을 제공 할 때 일반적입니다.

### 그림 2-3. 이벤트 중심 아키텍처 브로커 토폴로지
브로커 토폴로지의 작동 방식을 설명하기 위해 중개자 토폴로지 (피보험자가 이동)에서와 동일한 예를 사용합니다.
브로커 토폴로지에서 초기 이벤트를 수신 할 중앙 이벤트 중개자가 없으므로 고객 프로세스 구성 요소는 이벤트를 직접 수신하고 고객 주소를 변경하며 고객의 주소가 변경되었다는 이벤트를 보냅니다 (예 : 주소 변경 이벤트). .
이 예에서는 주소 변경 이벤트에 관심이있는 두 가지 이벤트 프로세서 인 견적 프로세스와 클레임 프로세스가 있습니다.
따옴표 처리기 구성 요소는 주소 변경을 기반으로 새 자동 보험료율을 다시 계산하고 수행 한 작업을 나타내는 이벤트를 시스템의 나머지 부분에 게시합니다 (예 : recalc quote 이벤트). 반면에 클레임 처리 구성 요소는 동일한 변경 주소 이벤트를 수신하지만이 경우 미해결 보험 클레임을 업데이트하고 이벤트를 업데이트 클레임 이벤트로 시스템에 게시합니다. 그런 다음이 새로운 이벤트는 다른 이벤트 프로세서 구성 요소에 의해 선택되며 해당 특정 시작 이벤트에 대해 더 이상 이벤트가 공개되지 않을 때까지 이벤트 체인이 시스템을 통해 계속됩니다.

### 그림 2-4. 브로커 토폴로지 예
그림 2-4에서 볼 수 있듯이 브로커 토폴로지는 비즈니스 기능을 수행하기위한 이벤트 체인에 관한 것입니다. 브로커 토폴로지를 이해하는 가장 좋은 방법은 릴레이 토폴로지로 생각하는 것입니다. 릴레이 경주에서 주자는 배턴을 잡고 일정 거리를두고 달리고, 마지막 주자가 결승선을 통과 할 때까지 다음 주자에게 배턴을 건네줍니다. 릴레이 경주에서, 주자가 배턴을 넘기면 레이스가 끝납니다. 브로커 토폴로지에서도 마찬가지입니다. 일단 이벤트 프로세서가 이벤트를 처리하면 더 이상 해당 특정 이벤트 처리에 관여하지 않습니다.


